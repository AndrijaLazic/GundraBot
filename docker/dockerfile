FROM node:22-bookworm-slim

WORKDIR /usr/src/app

# Build tools (for @discordjs/opus) + ffmpeg (required by prism-media) + CA certs (yt-dlp HTTPS)
RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 make g++ git \
    ffmpeg ca-certificates \
 && rm -rf /var/lib/apt/lists/*

# Install deps first (better layer caching)
COPY package*.json ./
RUN npm ci

# Copy the actual source code (your old file copied package*.json twice)
COPY . .
